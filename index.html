<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>Kompass Lead Daily Checklist</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        @media (max-width: 1024px) {
            .container {
                max-width: 95%;
            }
        }

        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                border-radius: 10px;
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .header-row-1,
        .header-row-2,
        .header-row-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .header-row-3 {
            grid-template-columns: repeat(2, 1fr);
        }

        .header-signature {
            margin: 20px auto;
            max-width: 600px;
            text-align: left;
        }

        .signature-label {
            font-weight: 600;
            font-size: 0.95em;
            display: block;
            margin-bottom: 8px;
        }

        .signature-canvas {
            border: 2px solid white;
            border-radius: 8px;
            background: white;
            cursor: crosshair;
            display: block;
            width: 100%;
            height: 120px;
            touch-action: none;
        }

        .btn-clear-sig {
            margin-top: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
            color: #667eea;
            font-weight: 600;
        }

        .btn-clear-sig:hover {
            background: white;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: left;
        }

        .input-group label {
            font-size: 0.85em;
            font-weight: 600;
            color: white;
        }

        .header-info input {
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 0.9em;
            width: 100%;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.2);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            min-width: 0;
            white-space: nowrap;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
            transition: opacity 0.2s ease;
        }

        .section-header:hover {
            opacity: 0.9;
        }

        .section-header:active {
            opacity: 0.8;
        }

        .section-content {
            padding: 20px;
            background: #fafafa;
        }

        .checklist-item {
            background: white;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .checklist-item.completed {
            border-left-color: #56ab2f;
            opacity: 0.7;
        }

        .item-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .checkbox-wrapper {
            flex-shrink: 0;
            padding-top: 2px;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #667eea;
            flex-shrink: 0;
        }

        .item-content {
            flex-grow: 1;
        }

        .item-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .item-description {
            color: #666;
            line-height: 1.6;
        }

        .item-description ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .item-description li {
            margin-bottom: 5px;
        }

        .eod-field {
            margin: 10px 0;
            padding: 10px;
            background: #f0f7ff;
            border-radius: 5px;
            border-left: 3px solid #2196F3;
        }

        .eod-field label {
            display: block;
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .eod-field input[type="text"],
        .eod-field textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.95em;
        }

        .eod-field textarea {
            min-height: 60px;
            resize: vertical;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 8px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .checkbox-option label {
            font-weight: 600;
            color: #333;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
        }

        .notes-section {
            margin-top: 30px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            border: 2px solid #ffc107;
        }

        .notes-section h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .notes-section textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
        }

        .email-list {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .email-list h4 {
            color: #1976d2;
            margin-bottom: 8px;
        }

        .email-list ul {
            list-style: none;
            margin-left: 0;
        }

        .email-list li {
            color: #0d47a1;
            padding: 3px 0;
        }

        .collapse-icon {
            transition: transform 0.3s ease;
        }

        .collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px 5px;
            }

            .container {
                border-radius: 10px;
                max-width: 100%;
            }

            .header {
                padding: 15px 12px;
            }

            .header h1 {
                font-size: 1.3em;
                margin-bottom: 12px;
            }

            .header-row-1,
            .header-row-2,
            .header-row-3 {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-bottom: 12px;
            }

            .header-signature {
                margin: 15px 0;
            }

            .signature-canvas {
                height: 150px;
            }

            .btn-clear-sig {
                width: 100%;
                padding: 12px;
            }

            .input-group label {
                font-size: 0.8em;
                margin-bottom: 3px;
            }

            .header-info input,
            .input-group input {
                padding: 10px;
                font-size: 1em;
                width: 100%;
            }

            .progress-bar-container {
                margin-top: 15px;
                height: 25px;
            }

            .progress-bar {
                font-size: 0.9em;
            }

            .content {
                padding: 15px 12px;
            }

            .section {
                margin-bottom: 20px;
            }

            .section-header {
                padding: 12px 15px;
                font-size: 1.1em;
            }

            .section-content {
                padding: 15px 12px;
            }

            .checklist-item {
                padding: 12px;
                margin-bottom: 12px;
            }

            .item-header {
                gap: 12px;
            }

            input[type="checkbox"] {
                width: 22px;
                height: 22px;
                flex-shrink: 0;
            }

            .item-title {
                font-size: 1em;
                margin-bottom: 8px;
                line-height: 1.3;
            }

            .item-description {
                font-size: 0.9em;
                line-height: 1.5;
            }

            .item-description ul {
                margin-left: 18px;
                margin-top: 8px;
            }

            .item-description li {
                margin-bottom: 6px;
            }

            .notes-section {
                padding: 15px;
                margin-top: 20px;
            }

            .notes-section h3 {
                font-size: 1em;
                margin-bottom: 10px;
            }

            .notes-section textarea {
                min-height: 120px;
                padding: 12px;
                font-size: 1em;
            }

            .email-list {
                padding: 12px;
            }

            .email-list h4 {
                font-size: 0.95em;
            }

            .email-list li {
                font-size: 0.85em;
                padding: 4px 0;
            }

            .button-group {
                flex-direction: column;
                gap: 12px;
            }

            .btn {
                width: 100%;
                padding: 15px 20px;
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 12px 10px;
            }

            .header h1 {
                font-size: 1.1em;
                margin-bottom: 10px;
            }

            .content {
                padding: 12px 10px;
            }

            .section-header {
                padding: 10px 12px;
                font-size: 1em;
            }

            .item-title {
                font-size: 0.95em;
            }

            .item-description {
                font-size: 0.85em;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
                max-width: 100%;
                margin: 0;
            }
            
            .header {
                background: #667eea !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                page-break-after: avoid;
                padding: 8px 10px;
            }
            
            .header h1 {
                font-size: 1em;
                margin-bottom: 5px;
            }
            
            .header-row-1,
            .header-row-2,
            .header-row-3 {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
                margin-bottom: 5px;
            }

            .header-row-3 {
                grid-template-columns: repeat(2, 1fr);
            }

            .header-signature {
                margin: 6px auto;
                max-width: 100%;
            }

            .signature-label {
                font-size: 0.7em;
                margin-bottom: 3px;
            }

            .signature-canvas {
                height: 60px;
                border: 2px solid white;
            }

            .btn-clear-sig {
                display: none;
            }
            
            .input-group {
                gap: 1px;
            }
            
            .input-group label {
                font-size: 0.55em;
                line-height: 1;
            }
            
            .input-group input {
                padding: 1px 3px;
                font-size: 0.65em;
            }
            
            .progress-bar-container {
                height: 12px;
                margin-top: 5px;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .progress-bar {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                font-size: 0.6em;
            }
            
            .content {
                padding: 6px 10px;
            }
            
            .section {
                page-break-inside: avoid;
                break-inside: avoid;
                margin-bottom: 5px;
            }
            
            .section:first-of-type {
                page-break-before: always;
            }
            
            .section:nth-of-type(2) {
                page-break-before: always;
            }
            
            .section:nth-of-type(3) {
                page-break-before: always;
            }
            
            .section-header {
                background: #667eea !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                padding: 4px 6px;
                font-size: 0.8em;
            }
            
            .section-content {
                padding: 4px 6px;
            }
            
            .checklist-item {
                page-break-inside: avoid;
                break-inside: avoid;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                margin-bottom: 3px;
                padding: 3px;
            }
            
            .item-title {
                font-size: 0.7em;
                margin-bottom: 1px;
            }
            
            .item-description {
                font-size: 0.6em;
                line-height: 1.2;
            }
            
            .item-description ul {
                margin-top: 1px;
                margin-bottom: 1px;
                margin-left: 12px;
            }
            
            .item-description li {
                margin-bottom: 0px;
            }
            
            .button-group {
                display: none;
            }
            
            .notes-section {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                page-break-inside: avoid;
                padding: 4px 6px;
                margin-top: 5px;
            }
            
            .notes-section h3 {
                font-size: 0.75em;
                margin-bottom: 3px;
            }
            
            .notes-section textarea {
                min-height: 30px;
                padding: 3px;
                font-size: 0.65em;
            }
            
            .email-list {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                padding: 4px;
                margin-top: 3px;
            }
            
            .email-list h4 {
                font-size: 0.65em;
                margin-bottom: 2px;
            }
            
            .email-list li {
                font-size: 0.6em;
                padding: 0px;
            }
            
            input[type="checkbox"] {
                width: 10px;
                height: 10px;
            }
            
            @page {
                size: letter;
                margin: 0.35in 0.4in;
            }
        }

        /* Ensure inputs are touch-friendly on mobile */
        @media (hover: none) and (pointer: coarse) {
            input, textarea, button {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }

            input[type="checkbox"] {
                width: 24px;
                height: 24px;
                min-width: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>KOMPASS LEAD DAILY CHECKLIST</h1>
            
            <!-- Row 1: Store, Date, Lead Name -->
            <div class="header-row-1">
                <div class="input-group">
                    <label>Store #:</label>
                    <input type="text" id="storeNumber" placeholder="Enter store number">
                </div>
                <div class="input-group">
                    <label>Date:</label>
                    <input type="date" id="date">
                </div>
                <div class="input-group">
                    <label>Lead Name:</label>
                    <input type="text" id="leadName" placeholder="Enter your name">
                </div>
            </div>

            <!-- Row 2: Times -->
            <div class="header-row-2">
                <div class="input-group">
                    <label>Lead Arrived at Store:</label>
                    <input type="time" id="arrivedTime">
                </div>
                <div class="input-group">
                    <label>Team Arrival Time:</label>
                    <input type="time" id="crewArrival">
                </div>
                <div class="input-group">
                    <label>Check-Out Time:</label>
                    <input type="time" id="checkoutTime">
                </div>
            </div>

            <!-- Row 3: Managers -->
            <div class="header-row-3">
                <div class="input-group">
                    <label>Manager Checked In With:</label>
                    <input type="text" id="groceryManager" placeholder="Manager's name">
                </div>
                <div class="input-group">
                    <label>Manager Checked Out With:</label>
                    <input type="text" id="checkoutManager" placeholder="Manager's name">
                </div>
            </div>

            <!-- Signature -->
            <div class="header-signature">
                <label class="signature-label">Lead Signature:</label>
                <canvas id="signatureCanvas" class="signature-canvas"></canvas>
                <button class="btn-clear-sig" onclick="clearSignature()">Clear Signature</button>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%;">0%</div>
            </div>
        </div>

        <div class="content">
            <!-- Section 1: Pre-Work Setup -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <span>PRE-WORK SETUP</span>
                    <span class="collapse-icon">▼</span>
                </div>
                <div class="section-content">
                    <div class="checklist-item" data-id="item-0">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">1.0 Download & "Fax" Print Weekly Materials</div>
                                <div class="item-description">
                                    <ul>
                                        <li>Download Kompass Notes, Sign-off Sheets, EOD Cover Sheet, and other materials</li>
                                        <li>Email to: <strong>tyson.gauthier@retailodyssey.com</strong></li>
                                        <li>Subject Line: <strong>#StoreNumber</strong> (e.g., #163)</li>
                                        <li>Attach documents and hit send</li>
                                        <li>You'll receive a confirmation email when it's time to pick them up at the customer service desk</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-1">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">1.1 Access the "Dump Bin"</div>
                                <div class="item-description">
                                    Your information hub for everything Kompass-related:
                                    <ul>
                                        <li>Navigate to your period/week folder</li>
                                        <li>Review "Considerations" and "Test Set Notes"</li>
                                        <li>Review "Inventory Schedule" and "Strip Installation" dates for awareness</li>
                                        <li>Review "Final Kompass Notes" (deleted items, new items, UPC changes, set instructions)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-2">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">1.3 Arrive Early</div>
                                <div class="item-description">
                                    <ul>
                                        <li>Arrive at the store at least 1 hour before the team</li>
                                        <li>Get organized and review the day's plan</li>
                                        <li>Take a "before" photo of the Kompass cart (Maintenance section)</li>
                                        <li>Check in with and record the grocery manager's name</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-3">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">1.4 Locate the Kompass Box (Vestcom Box)</div>
                                <div class="item-description">
                                    <ul>
                                        <li>White box with blue lettering containing label strips</li>
                                        <li>Check: price change room, office, Kompass cart, receiver's desk</li>
                                        <li>If missing: Use "Vestcom Box Tracking" file in dump bin</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-4">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">1.5 Organize the Strips & Planograms</div>
                                <div class="item-description">
                                    <ul>
                                        <li>Arrange strips and planograms on check stand or preferred area</li>
                                        <li>Speak with head cashier (red vest) about using the space and when you should be prepared to move</li>
                                        <li>Separate and include the UPLs/price tags</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-5">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">1.6 Sync Your Tablet Frequently</div>
                                <div class="item-description">
                                    Resync after completing major tasks, surveys, and uploading pictures
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: During Work -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <span>DURING WORK</span>
                    <span class="collapse-icon">▼</span>
                </div>
                <div class="section-content">
                    <div class="checklist-item" data-id="item-6">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.1 Plan the Day Strategically</div>
                                <div class="item-description">
                                    <ul>
                                        <li>Identify large/time-intensive sets from Kompass Notes</li>
                                        <li>Contact department heads for coordination</li>
                                        <li>Ask about preferred days/timing (non-load days)</li>
                                        <li><strong>Complete priority and fuel sets first and close them out by 9 AM</strong></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-7">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.2 Coordinate with Vendors</div>
                                <div class="item-description">
                                    Notify vendor reps in advance (Coke, Pepsi, Dr. Pepper, Columbia/Frito Lay, Tim's, Mission, etc.)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-8">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.3 Check In with PIC and Record Name <span style="color: #f39c12; font-weight: bold;">EOD</span></div>
                                <div class="item-description">
                                    Check in with the person in charge (PIC) and record their name
                                    
                                    <div class="eod-field">
                                        <label>Manager's name you checked in with:</label>
                                        <input type="text" id="eodCheckInManager" placeholder="Enter manager's name">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-9">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.4 Maintain Professional Relationships</div>
                                <div class="item-description">
                                    Adjust approach for each store, build positive relationships with staff
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-10">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.5 Assign Sets Fairly</div>
                                <div class="item-description">
                                    <ul>
                                        <li>Consider experience level, aptitude, and strengths</li>
                                        <li>Avoid favoritism - don't repeatedly assign difficult sets to same person</li>
                                        <li>Assign based on ability, not preference</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-11">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.6 Manage Crew Workflow</div>
                                <div class="item-description">
                                    <ul>
                                        <li>Limit to 2 people per 12 feet of set</li>
                                        <li>Track participation: Use 1st page of Kompass Notes</li>
                                        <li>Have each person/group initial with start and finish times</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-12">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.7 Handle Surveys Early</div>
                                <div class="item-description">
                                    Complete required surveys on the first morning of each store visit
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-13">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.8 Take "Before" and "After" Photos in PROD</div>
                                <div class="item-description">
                                    <strong>Before photos:</strong> Immediately after assigning first sets<br>
                                    <strong>After photos:</strong> Immediately after each set is fully complete:
                                    <ul>
                                        <li>All strips in, shelves adjusted, tags hung, new items placed</li>
                                        <li>"Overstock" and "Not in Set" items labeled and organized</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-14">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.9 "After" Photos with Store Intelligence</div>
                                <div class="item-description">
                                    After photos - Immediately after each set is fully complete:
                                    <ul>
                                        <li>Bay by bay for each set take a photo</li>
                                        <li>Clear exceptions through the actions section</li>
                                        <li>Ensure all sets completed in PROD are completed in Store Intelligence</li>
                                        <li><strong>This needs to be done prior to your leaving the store</strong></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-15">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">2.10 Handle Issues and Contact Support if Needed <span style="color: #f39c12; font-weight: bold;">EOD</span></div>
                                <div class="item-description">
                                    If problems occur (incorrect planogram, wrong footage, fixture issues, store refusal):
                                    <ul>
                                        <li>First contact your supervisor and inform them of the issue</li>
                                        <li>Get name and title of person refusing the set or details of the issue</li>
                                        <li>Your supervisor may request you contact Kompass support: <strong>kompass@retailodyssey.com</strong> (CC supervisor)</li>
                                    </ul>
                                    
                                    <div class="eod-field">
                                        <label>Did you call the KOMPASS Hotline?</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodHotlineYes" onchange="toggleHotlineFields(this)">
                                                <label for="eodHotlineYes">Yes</label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodHotlineNo" onchange="toggleHotlineFields(this)">
                                                <label for="eodHotlineNo">No</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="hotlineDetails" style="display: none;">
                                        <div class="eod-field">
                                            <label>If so, what commodities are involved?</label>
                                            <input type="text" id="eodCommodities" placeholder="Enter commodities">
                                        </div>

                                        <div class="eod-field">
                                            <label>What is the issue?</label>
                                            <textarea id="eodIssue" placeholder="Describe the issue"></textarea>
                                        </div>

                                        <div class="eod-field">
                                            <label>Was the issue resolved before EOD?</label>
                                            <div class="checkbox-group">
                                                <div class="checkbox-option">
                                                    <input type="checkbox" id="eodResolvedYes" onchange="toggleResolutionField(this)">
                                                    <label for="eodResolvedYes">Yes</label>
                                                </div>
                                                <div class="checkbox-option">
                                                    <input type="checkbox" id="eodResolvedNo" onchange="toggleResolutionField(this)">
                                                    <label for="eodResolvedNo">No</label>
                                                </div>
                                                <div class="checkbox-option">
                                                    <input type="checkbox" id="eodResolvedNA" onchange="toggleResolutionField(this)">
                                                    <label for="eodResolvedNA">N/A</label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="eod-field" id="tempSolutionField" style="display: none;">
                                            <label>If not, what was the temporary solution?</label>
                                            <textarea id="eodTempSolution" placeholder="Describe temporary solution"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: End of Day -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <span>END OF DAY</span>
                    <span class="collapse-icon">▼</span>
                </div>
                <div class="section-content">
                    <div class="checklist-item" data-id="item-16">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">3.1 Walk Sets and Complete Sign-Offs <span style="color: #f39c12; font-weight: bold;">EOD</span></div>
                                <div class="item-description">
                                    <ul>
                                        <li>Walk each set with store personnel to verify completion</li>
                                        <li>Show them where you placed overstock/discontinued items</li>
                                        <li>Complete and review Kompass Sign-Off sheets with store representative</li>
                                        <li>Before giving them their copy, take a photo of the sign-off sheet for records</li>
                                        <li>Leave a signed copy with them</li>
                                        <li>Ask them to complete Kompass Completion online</li>
                                        <li>Record the name of the person you checked out with</li>
                                    </ul>

                                    <div class="eod-field">
                                        <label>Manager's name you checked out with:</label>
                                        <input type="text" id="eodCheckOutManager" placeholder="Enter manager's name">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-17">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">3.2 Complete PROD and SI Sign-Offs <span style="color: #f39c12; font-weight: bold;">EOD</span></div>
                                <div class="item-description">
                                    Verify all sets are signed off in both systems
                                    
                                    <div class="eod-field">
                                        <label>Did all sets get signed out in PROD?</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodProdYes">
                                                <label for="eodProdYes">Yes</label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodProdNo">
                                                <label for="eodProdNo">No</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="eod-field">
                                        <label>Did all sets get signed out in SI?</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodSiYes">
                                                <label for="eodSiYes">Yes</label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodSiNo">
                                                <label for="eodSiNo">No</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-18">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">3.3 Sign-Off Sheet Documentation <span style="color: #f39c12; font-weight: bold;">EOD</span></div>
                                <div class="item-description">
                                    Ensure proper documentation of sign-off sheets

                                    <div class="eod-field">
                                        <label>Sign out sheet attached to EOD email?</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodEmailSheetYes">
                                                <label for="eodEmailSheetYes">Yes</label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodEmailSheetNo">
                                                <label for="eodEmailSheetNo">No</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="eod-field">
                                        <label>Sign out sheet attached to KOMPASS Maintenance line in PROD?</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodProdSheetYes">
                                                <label for="eodProdSheetYes">Yes</label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodProdSheetNo">
                                                <label for="eodProdSheetNo">No</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-19">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">3.4 Kompass Cart Photos <span style="color: #f39c12; font-weight: bold;">EOD</span></div>
                                <div class="item-description">
                                    Take clear, in-focus photos of Kompass cart

                                    <div class="eod-field">
                                        <label>Before picture of KOMPASS cart loaded to KOMPASS Maintenance line?</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodBeforePhotoYes">
                                                <label for="eodBeforePhotoYes">Yes</label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodBeforePhotoNo">
                                                <label for="eodBeforePhotoNo">No</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="eod-field">
                                        <label>After picture of KOMPASS cart loaded to KOMPASS Maintenance line?</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodAfterPhotoYes">
                                                <label for="eodAfterPhotoYes">Yes</label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="eodAfterPhotoNo">
                                                <label for="eodAfterPhotoNo">No</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-20">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">3.5 Final Quality Check</div>
                                <div class="item-description">
                                    Verify all pictures are clear, well-lit, in focus, and properly attached
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-21">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">3.6 Compose the EOD Email</div>
                                <div class="item-description">
                                    <ul>
                                        <li><strong>To:</strong> Fred Meyer PIC + store management</li>
                                        <li><strong>CC:</strong> See email list below</li>
                                        <li><strong>Subject:</strong> EOD FM#'## MM/DD/YYYY</li>
                                        <li><strong>Attachments:</strong> Sign-off sheets, EOD Cover Sheet, photos</li>
                                    </ul>
                                    <div class="email-list">
                                        <h4>EOD Email CC List:</h4>
                                        <ul>
                                            <li>mashabranner@retailodyssey.com</li>
                                            <li>seth.newman@retailodyssey.com</li>
                                            <li>knix@retailodyssey.com</li>
                                            <li>yoursupervisor@retailodyssey.com</li>
                                            <li>yourself@retailodyssey.com</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checklist-item" data-id="item-22">
                        <div class="item-header">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" onchange="updateProgress()">
                            </div>
                            <div class="item-content">
                                <div class="item-title">3.7 Final Time Requirements</div>
                                <div class="item-description">
                                    <strong>Ensure that:</strong>
                                    <ul>
                                        <li>All work is completed by <strong>2:30 PM</strong></li>
                                        <li>EOD emails sent by <strong>3:00 PM</strong></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes Section -->
            <div class="notes-section">
                <h3>NOTES & ISSUES:</h3>
                <textarea id="notes" placeholder="Enter any notes, issues, or observations here..."></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="button-group">
                <button class="btn btn-success" onclick="generateEODCoverSheet()">Generate EOD Cover Sheet</button>
                <button class="btn btn-primary" onclick="saveProgress(event)">Save to Device</button>
                <button class="btn btn-secondary" onclick="resetChecklist()">Reset Checklist</button>
                <button class="btn btn-secondary" onclick="window.print()">Print Checklist</button>
            </div>
        </div>
    </div>

    <script>
        // Set today's date by default
        document.getElementById('date').valueAsDate = new Date();

        // Load saved data on page load
        window.onload = function() {
            loadProgress();
            updateProgress();
        };

        function toggleSection(header) {
            const section = header.parentElement;
            const content = section.querySelector('.section-content');
            section.classList.toggle('collapsed');
            
            if (section.classList.contains('collapsed')) {
                content.style.display = 'none';
            } else {
                content.style.display = 'block';
            }
        }

        function updateProgress() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const checked = document.querySelectorAll('.checklist-item input[type="checkbox"]:checked');
            const percentage = Math.round((checked.length / checkboxes.length) * 100);
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';

            // Update completed styling
            checkboxes.forEach(checkbox => {
                const item = checkbox.closest('.checklist-item');
                if (checkbox.checked) {
                    item.classList.add('completed');
                } else {
                    item.classList.remove('completed');
                }
            });

            // Auto-save when checking/unchecking
            autoSave();
        }

        function toggleHotlineFields(checkbox) {
            const yesBox = document.getElementById('eodHotlineYes');
            const noBox = document.getElementById('eodHotlineNo');
            const detailsDiv = document.getElementById('hotlineDetails');
            
            // Toggle mutual exclusivity
            if (checkbox.id === 'eodHotlineYes' && checkbox.checked) {
                noBox.checked = false;
                detailsDiv.style.display = 'block';
            } else if (checkbox.id === 'eodHotlineNo' && checkbox.checked) {
                yesBox.checked = false;
                detailsDiv.style.display = 'none';
            } else if (!yesBox.checked && !noBox.checked) {
                detailsDiv.style.display = 'none';
            }
            
            autoSave();
        }

        function toggleResolutionField(checkbox) {
            const yesBox = document.getElementById('eodResolvedYes');
            const noBox = document.getElementById('eodResolvedNo');
            const naBox = document.getElementById('eodResolvedNA');
            const tempSolutionField = document.getElementById('tempSolutionField');
            
            // Toggle mutual exclusivity
            if (checkbox.id === 'eodResolvedYes' && checkbox.checked) {
                noBox.checked = false;
                naBox.checked = false;
                tempSolutionField.style.display = 'none';
            } else if (checkbox.id === 'eodResolvedNo' && checkbox.checked) {
                yesBox.checked = false;
                naBox.checked = false;
                tempSolutionField.style.display = 'block';
            } else if (checkbox.id === 'eodResolvedNA' && checkbox.checked) {
                yesBox.checked = false;
                noBox.checked = false;
                tempSolutionField.style.display = 'none';
            }
            
            autoSave();
        }

        function autoSave() {
            const data = {
                storeNumber: document.getElementById('storeNumber').value,
                date: document.getElementById('date').value,
                leadName: document.getElementById('leadName').value,
                arrivedTime: document.getElementById('arrivedTime').value,
                groceryManager: document.getElementById('groceryManager').value,
                crewArrival: document.getElementById('crewArrival').value,
                notes: document.getElementById('notes').value,
                checkoutManager: document.getElementById('checkoutManager').value,
                checkoutTime: document.getElementById('checkoutTime').value,
                signature: canvas.toDataURL(),
                eodCheckInManager: document.getElementById('eodCheckInManager').value,
                eodCheckOutManager: document.getElementById('eodCheckOutManager').value,
                eodHotlineYes: document.getElementById('eodHotlineYes').checked,
                eodHotlineNo: document.getElementById('eodHotlineNo').checked,
                eodCommodities: document.getElementById('eodCommodities').value,
                eodIssue: document.getElementById('eodIssue').value,
                eodResolvedYes: document.getElementById('eodResolvedYes').checked,
                eodResolvedNo: document.getElementById('eodResolvedNo').checked,
                eodResolvedNA: document.getElementById('eodResolvedNA').checked,
                eodTempSolution: document.getElementById('eodTempSolution').value,
                eodProdYes: document.getElementById('eodProdYes').checked,
                eodProdNo: document.getElementById('eodProdNo').checked,
                eodSiYes: document.getElementById('eodSiYes').checked,
                eodSiNo: document.getElementById('eodSiNo').checked,
                eodEmailSheetYes: document.getElementById('eodEmailSheetYes').checked,
                eodEmailSheetNo: document.getElementById('eodEmailSheetNo').checked,
                eodProdSheetYes: document.getElementById('eodProdSheetYes').checked,
                eodProdSheetNo: document.getElementById('eodProdSheetNo').checked,
                eodBeforePhotoYes: document.getElementById('eodBeforePhotoYes').checked,
                eodBeforePhotoNo: document.getElementById('eodBeforePhotoNo').checked,
                eodAfterPhotoYes: document.getElementById('eodAfterPhotoYes').checked,
                eodAfterPhotoNo: document.getElementById('eodAfterPhotoNo').checked,
                checkedItems: []
            };

            // Save checkbox states
            document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach((checkbox, index) => {
                data.checkedItems.push(checkbox.checked);
            });

            localStorage.setItem('kompassChecklist', JSON.stringify(data));
        }

        function saveProgress(event) {
            autoSave();
            
            // Show confirmation
            if (event && event.target) {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Saved to Device Memory!';
                btn.style.background = 'linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }
        }

        function loadProgress() {
            const saved = localStorage.getItem('kompassChecklist');
            if (saved) {
                const data = JSON.parse(saved);
                
                document.getElementById('storeNumber').value = data.storeNumber || '';
                document.getElementById('date').value = data.date || new Date().toISOString().split('T')[0];
                document.getElementById('leadName').value = data.leadName || '';
                document.getElementById('arrivedTime').value = data.arrivedTime || '';
                document.getElementById('groceryManager').value = data.groceryManager || '';
                document.getElementById('crewArrival').value = data.crewArrival || '';
                document.getElementById('notes').value = data.notes || '';
                document.getElementById('checkoutManager').value = data.checkoutManager || '';
                document.getElementById('checkoutTime').value = data.checkoutTime || '';
                
                // Load EOD fields
                if (data.eodCheckInManager) document.getElementById('eodCheckInManager').value = data.eodCheckInManager;
                if (data.eodCheckOutManager) document.getElementById('eodCheckOutManager').value = data.eodCheckOutManager;
                if (data.eodHotlineYes) document.getElementById('eodHotlineYes').checked = true;
                if (data.eodHotlineNo) document.getElementById('eodHotlineNo').checked = true;
                if (data.eodCommodities) document.getElementById('eodCommodities').value = data.eodCommodities;
                if (data.eodIssue) document.getElementById('eodIssue').value = data.eodIssue;
                if (data.eodResolvedYes) document.getElementById('eodResolvedYes').checked = true;
                if (data.eodResolvedNo) document.getElementById('eodResolvedNo').checked = true;
                if (data.eodResolvedNA) document.getElementById('eodResolvedNA').checked = true;
                if (data.eodTempSolution) document.getElementById('eodTempSolution').value = data.eodTempSolution;
                if (data.eodProdYes) document.getElementById('eodProdYes').checked = true;
                if (data.eodProdNo) document.getElementById('eodProdNo').checked = true;
                if (data.eodSiYes) document.getElementById('eodSiYes').checked = true;
                if (data.eodSiNo) document.getElementById('eodSiNo').checked = true;
                if (data.eodEmailSheetYes) document.getElementById('eodEmailSheetYes').checked = true;
                if (data.eodEmailSheetNo) document.getElementById('eodEmailSheetNo').checked = true;
                if (data.eodProdSheetYes) document.getElementById('eodProdSheetYes').checked = true;
                if (data.eodProdSheetNo) document.getElementById('eodProdSheetNo').checked = true;
                if (data.eodBeforePhotoYes) document.getElementById('eodBeforePhotoYes').checked = true;
                if (data.eodBeforePhotoNo) document.getElementById('eodBeforePhotoNo').checked = true;
                if (data.eodAfterPhotoYes) document.getElementById('eodAfterPhotoYes').checked = true;
                if (data.eodAfterPhotoNo) document.getElementById('eodAfterPhotoNo').checked = true;

                // Show hotline details if yes is checked
                if (data.eodHotlineYes) {
                    document.getElementById('hotlineDetails').style.display = 'block';
                }
                
                // Show temp solution field if issue not resolved
                if (data.eodResolvedNo) {
                    document.getElementById('tempSolutionField').style.display = 'block';
                }

                // Restore signature
                if (data.signature) {
                    const img = new Image();
                    img.onload = function() {
                        ctx.drawImage(img, 0, 0);
                    };
                    img.src = data.signature;
                }

                // Restore checkbox states
                if (data.checkedItems) {
                    document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach((checkbox, index) => {
                        if (data.checkedItems[index]) {
                            checkbox.checked = true;
                        }
                    });
                }
            }
        }

        function resetChecklist() {
            if (confirm('Are you sure you want to reset the checklist? This will clear all progress.')) {
                localStorage.removeItem('kompassChecklist');
                
                // Reset all fields
                document.getElementById('storeNumber').value = '';
                document.getElementById('date').valueAsDate = new Date();
                document.getElementById('leadName').value = '';
                document.getElementById('arrivedTime').value = '';
                document.getElementById('groceryManager').value = '';
                document.getElementById('crewArrival').value = '';
                document.getElementById('notes').value = '';
                document.getElementById('checkoutManager').value = '';
                document.getElementById('checkoutTime').value = '';
                
                // Reset EOD fields
                document.getElementById('eodCheckInManager').value = '';
                document.getElementById('eodCheckOutManager').value = '';
                document.getElementById('eodHotlineYes').checked = false;
                document.getElementById('eodHotlineNo').checked = false;
                document.getElementById('eodCommodities').value = '';
                document.getElementById('eodIssue').value = '';
                document.getElementById('eodResolvedYes').checked = false;
                document.getElementById('eodResolvedNo').checked = false;
                document.getElementById('eodResolvedNA').checked = false;
                document.getElementById('eodTempSolution').value = '';
                document.getElementById('eodProdYes').checked = false;
                document.getElementById('eodProdNo').checked = false;
                document.getElementById('eodSiYes').checked = false;
                document.getElementById('eodSiNo').checked = false;
                document.getElementById('eodEmailSheetYes').checked = false;
                document.getElementById('eodEmailSheetNo').checked = false;
                document.getElementById('eodProdSheetYes').checked = false;
                document.getElementById('eodProdSheetNo').checked = false;
                document.getElementById('eodBeforePhotoYes').checked = false;
                document.getElementById('eodBeforePhotoNo').checked = false;
                document.getElementById('eodAfterPhotoYes').checked = false;
                document.getElementById('eodAfterPhotoNo').checked = false;
                
                // Clear signature
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Uncheck all checkboxes
                document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                updateProgress();
            }
        }

        function generateEODCoverSheet() {
            // Collect all the data
            const leadName = document.getElementById('leadName').value || '[Not Provided]';
            const date = document.getElementById('date').value || '[Not Provided]';
            const storeNumber = document.getElementById('storeNumber').value || '[Not Provided]';
            
            // Use EOD-specific fields, fall back to header fields
            const checkInManager = document.getElementById('eodCheckInManager').value || 
                                  document.getElementById('groceryManager').value || '[Not Provided]';
            const checkOutManager = document.getElementById('eodCheckOutManager').value || 
                                   document.getElementById('checkoutManager').value || '[Not Provided]';
            
            const hotlineYes = document.getElementById('eodHotlineYes').checked;
            const hotlineNo = document.getElementById('eodHotlineNo').checked;
            const commodities = document.getElementById('eodCommodities').value || '[Not Provided]';
            const issue = document.getElementById('eodIssue').value || '[Not Provided]';
            const resolvedYes = document.getElementById('eodResolvedYes').checked;
            const resolvedNo = document.getElementById('eodResolvedNo').checked;
            const resolvedNA = document.getElementById('eodResolvedNA').checked;
            const tempSolution = document.getElementById('eodTempSolution').value || '[Not Provided]';
            
            const prodYes = document.getElementById('eodProdYes').checked;
            const prodNo = document.getElementById('eodProdNo').checked;
            const siYes = document.getElementById('eodSiYes').checked;
            const siNo = document.getElementById('eodSiNo').checked;
            const emailSheetYes = document.getElementById('eodEmailSheetYes').checked;
            const emailSheetNo = document.getElementById('eodEmailSheetNo').checked;
            const prodSheetYes = document.getElementById('eodProdSheetYes').checked;
            const prodSheetNo = document.getElementById('eodProdSheetNo').checked;
            const beforePhotoYes = document.getElementById('eodBeforePhotoYes').checked;
            const beforePhotoNo = document.getElementById('eodBeforePhotoNo').checked;
            const afterPhotoYes = document.getElementById('eodAfterPhotoYes').checked;
            const afterPhotoNo = document.getElementById('eodAfterPhotoNo').checked;

            // Create the EOD Cover Sheet content
            let eodContent = `KOMPASS EOD COVER SHEET
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Lead Name: ${leadName}
Date: ${date}
Store Number: ${storeNumber}

Before picture of KOMPASS cart loaded to KOMPASS Maintenance line? ${beforePhotoYes ? '☑' : '☐'} Yes ${beforePhotoNo ? '☑' : '☐'} No

Manager's name you checked in with: ${checkInManager}

Did you call the KOMPASS Hotline? ${hotlineYes ? '☑' : '☐'} Yes ${hotlineNo ? '☑' : '☐'} No

If so, what commodities are involved?
${hotlineYes ? commodities : 'N/A'}

What is the issue?
${hotlineYes ? issue : 'N/A'}

Was the issue resolved before EOD? ${resolvedYes ? '☑' : '☐'} Yes ${resolvedNo ? '☑' : '☐'} No ${resolvedNA ? '☑' : '☐'} N/A

If not, what was the temporary solution?
${resolvedNo ? tempSolution : 'N/A'}

Manager's name you checked out with: ${checkOutManager}

Did all sets get signed out in PROD? ${prodYes ? '☑' : '☐'} Yes ${prodNo ? '☑' : '☐'} No

Did all sets get signed out in SI? ${siYes ? '☑' : '☐'} Yes ${siNo ? '☑' : '☐'} No

Sign out sheet attached to EOD email? ${emailSheetYes ? '☑' : '☐'} Yes ${emailSheetNo ? '☑' : '☐'} No

Sign out sheet attached to KOMPASS Maintenance line in PROD? ${prodSheetYes ? '☑' : '☐'} Yes ${prodSheetNo ? '☑' : '☐'} No

After picture of KOMPASS cart loaded to KOMPASS Maintenance line? ${afterPhotoYes ? '☑' : '☐'} Yes ${afterPhotoNo ? '☑' : '☐'} No

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

EOD Subject Line: EOD FM${storeNumber} ${formatDateForSubject(date)}

To: Fred Meyer PIC who signed you out (typically firstname.lastname@stores.fredmeyer.com) and other managers.

CC: mashabranner@retailodyssey.com; seth.newman@retailodyssey.com; knix@retailodyssey.com; & your supervisor.`;

            // Download the EOD Cover Sheet
            const blob = new Blob([eodContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `EOD_FM${storeNumber}_${date}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Show success message
            alert('EOD Cover Sheet generated and downloaded successfully!\n\nPlease review the file and attach it to your EOD email along with sign-off sheets and photos.');
        }

        function formatDateForSubject(dateStr) {
            if (!dateStr) return '[Date]';
            const date = new Date(dateStr);
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const year = date.getFullYear();
            return `${month}/${day}/${year}`;
        }

        // Auto-save form fields
        const formFields = [
            'storeNumber', 'date', 'leadName', 'arrivedTime', 'groceryManager', 
            'crewArrival', 'notes', 'checkoutManager', 'checkoutTime',
            'eodCheckInManager', 'eodCheckOutManager', 'eodCommodities', 
            'eodIssue', 'eodTempSolution'
        ];
        
        formFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('change', autoSave);
                field.addEventListener('blur', autoSave);
            }
        });

        // Signature Pad functionality
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // Set canvas size
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // Redraw signature if it exists
            const saved = localStorage.getItem('kompassChecklist');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.signature) {
                    const img = new Image();
                    img.onload = function() {
                        ctx.drawImage(img, 0, 0);
                    };
                    img.src = data.signature;
                }
            }
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Drawing functions
        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            lastX = touch.clientX - rect.left;
            lastY = touch.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            const currentX = touch.clientX - rect.left;
            const currentY = touch.clientY - rect.top;

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(currentX, currentY);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();

            lastX = currentX;
            lastY = currentY;
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                autoSave(); // Save signature when done drawing
            }
        }

        // Mouse events
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch events
        canvas.addEventListener('touchstart', startDrawing, { passive: false });
        canvas.addEventListener('touchmove', draw, { passive: false });
        canvas.addEventListener('touchend', stopDrawing);

        // Clear signature function
        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            autoSave();
        }
    </script>
</body>
</html>
